# ç®€å†æäº¤æµç¨‹è¯¦è§£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å­¦ç”Ÿä¸Šä¼ ç®€å†çš„å®Œæ•´æµç¨‹ï¼Œä»å‰ç«¯ç”¨æˆ·æ“ä½œåˆ°åç«¯æ•°æ®å¤„ç†çš„å…¨è¿‡ç¨‹ã€‚

---

## ğŸ“‹ æµç¨‹æ¦‚è§ˆ

```
ç”¨æˆ·é€‰æ‹©PDFæ–‡ä»¶
    â†“
å‰ç«¯éªŒè¯ï¼ˆç±»å‹ã€å¤§å°ï¼‰
    â†“
è½¬æ¢ä¸ºBase64ç¼–ç 
    â†“
å‘é€åˆ°åç«¯API
    â†“
åç«¯éªŒè¯
    â†“
PDFæ–‡æœ¬è§£æï¼ˆpdfjs-distï¼‰
    â†“
AIç»“æ„åŒ–æå–ï¼ˆLLMï¼‰
    â†“
ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°å­˜å‚¨
    â†“
æ›´æ–°æ•°æ®åº“ï¼ˆå­¦ç”Ÿæ¡£æ¡ˆè¡¨ï¼‰
    â†“
è¿”å›è§£æç»“æœ
    â†“
å‰ç«¯è‡ªåŠ¨å¡«å……è¡¨å•
```

---

## ğŸ” è¯¦ç»†æµç¨‹æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå‰ç«¯æ–‡ä»¶é€‰æ‹©ä¸éªŒè¯

**ä½ç½®**ï¼š`client/src/pages/student/Profile.tsx`

**æµç¨‹**ï¼š

1. **ç”¨æˆ·ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"æŒ‰é’®**
   ```typescript
   const handleFileUpload = () => {
     fileInputRef.current?.click();
   };
   ```

2. **æ–‡ä»¶é€‰æ‹©äº‹ä»¶å¤„ç†** (`handleFileChange`)
   - **éªŒè¯æ–‡ä»¶ç±»å‹**ï¼šå¿…é¡»æ˜¯ `.pdf` æ ¼å¼
   ```typescript
   if (!file.name.toLowerCase().endsWith(".pdf")) {
     toast.error("ä»…æ”¯æŒPDFæ ¼å¼æ–‡ä»¶");
     return;
   }
   ```
   
   - **éªŒè¯æ–‡ä»¶å¤§å°**ï¼šä¸è¶…è¿‡ 10MB
   ```typescript
   const maxSize = 10 * 1024 * 1024;
   if (file.size > maxSize) {
     toast.error("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB");
     return;
   }
   ```

3. **è½¬æ¢ä¸ºBase64ç¼–ç **
   ```typescript
   const base64 = await new Promise<string>((resolve, reject) => {
     const reader = new FileReader();
     reader.onload = () => {
       const result = reader.result as string;
       resolve(result); // æ ¼å¼: "data:application/pdf;base64,JVBERi0..."
     };
     reader.readAsDataURL(file);
   });
   ```

4. **è°ƒç”¨tRPCæ¥å£ä¸Šä¼ **
   ```typescript
   const result = await uploadResumeMutation.mutateAsync({
     file: base64,
     fileName: file.name,
     fileSize: file.size,
   });
   ```

**çŠ¶æ€ç®¡ç†**ï¼š
- `uploadStatus`: `"idle"` â†’ `"uploading"` â†’ `"parsing"` â†’ `"success"`

---

### ç¬¬äºŒæ­¥ï¼šåç«¯æ¥æ”¶ä¸éªŒè¯

**ä½ç½®**ï¼š`server/routes/student.ts` â†’ `uploadResume` mutation

**æµç¨‹**ï¼š

1. **tRPCè·¯ç”±æ¥æ”¶è¯·æ±‚**
   - ä½¿ç”¨ `studentProcedure` ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
   - è¾“å…¥éªŒè¯ï¼ˆZod schemaï¼‰ï¼š
     ```typescript
     z.object({
       file: z.string(), // Base64ç¼–ç çš„PDF
       fileName: z.string(),
       fileSize: z.number().max(10 * 1024 * 1024),
     })
     ```

2. **åç«¯éªŒè¯**
   ```typescript
   // éªŒè¯æ–‡ä»¶ç±»å‹
   if (!input.fileName.toLowerCase().endsWith(".pdf")) {
     throw new Error("ä»…æ”¯æŒPDFæ ¼å¼æ–‡ä»¶");
   }
   
   // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆBase64ç¼–ç åå¤§çº¦å¢åŠ 33%ï¼‰
   const estimatedSize = (input.file.length * 3) / 4;
   if (estimatedSize > 10 * 1024 * 1024) {
     throw new Error("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB");
   }
   ```

---

### ç¬¬ä¸‰æ­¥ï¼šPDFæ–‡æœ¬è§£æ

**ä½ç½®**ï¼š`server/services/resume-parser.ts`

**æµç¨‹**ï¼š

1. **ä»Base64è½¬æ¢ä¸ºBuffer**
   ```typescript
   // ç§»é™¤data URLå‰ç¼€ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
   const base64Data = input.file.includes(",") 
     ? input.file.split(",")[1] 
     : input.file;
   
   const buffer = Buffer.from(base64Data, "base64");
   const uint8Data = new Uint8Array(buffer);
   ```

2. **ä½¿ç”¨pdfjs-distè§£æPDF**
   ```typescript
   const loadingTask = pdfjsLib.getDocument({ data: uint8Data });
   const pdf = await loadingTask.promise;
   
   // é€é¡µæå–æ–‡æœ¬
   for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
     const page = await pdf.getPage(pageNum);
     const content = await page.getTextContent();
     const strings = content.items.map(item => item.str);
     fullText += strings.join(" ") + "\n";
   }
   ```

3. **è¿”å›è§£æç»“æœ**
   ```typescript
   {
     text: fullText,        // æå–çš„æ–‡æœ¬å†…å®¹
     pages: pdf.numPages,   // PDFé¡µæ•°
     info: { ... }          // PDFå…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰
   }
   ```

**é”™è¯¯å¤„ç†**ï¼š
- å¦‚æœPDFæ˜¯çº¯å›¾ç‰‡æ‰«æä»¶ï¼ˆæ— æ³•æå–æ–‡æœ¬ï¼‰ï¼Œä¼šæŠ›å‡ºé”™è¯¯
- é”™è¯¯ä¿¡æ¯ï¼š`"PDFä¸­æœªæå–åˆ°ä»»ä½•æ–‡æœ¬å†…å®¹ï¼ˆå¯èƒ½æ˜¯çº¯å›¾ç‰‡æ‰«æä»¶ï¼‰"`

---

### ç¬¬å››æ­¥ï¼šAIç»“æ„åŒ–ä¿¡æ¯æå–

**ä½ç½®**ï¼š`server/services/ai/resume-ai-parser.ts`

**æµç¨‹**ï¼š

1. **æ–‡æœ¬é¢„å¤„ç†**
   ```typescript
   // æ¸…ç†å’Œæˆªæ–­æ–‡æœ¬ï¼ˆæœ€å¤š8000å­—ç¬¦ï¼‰
   const cleanText = resumeText.trim();
   const truncatedText = cleanText.length > 8000 
     ? cleanText.substring(0, 8000) + "\n\n(æ–‡æœ¬å·²æˆªæ–­)" 
     : cleanText;
   ```

2. **æ„å»ºAIæç¤ºè¯**
   - ç³»ç»Ÿæç¤ºï¼š`"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç®€å†è§£æåŠ©æ‰‹ï¼Œæ“…é•¿ä»ç®€å†æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯ã€‚"`
   - ç”¨æˆ·æç¤ºï¼šåŒ…å«ç®€å†æ–‡æœ¬å’Œéœ€è¦æå–çš„å­—æ®µè¯´æ˜
   - éœ€è¦æå–çš„å­—æ®µï¼š
     - `studentId` - å­¦å·
     - `grade` - å¹´çº§
     - `major` - ä¸“ä¸š
     - `gpa` - ç»©ç‚¹
     - `skills` - æŠ€èƒ½æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰
     - `researchInterests` - ç ”ç©¶å…´è¶£
     - `projectExperience` - é¡¹ç›®ç»éªŒ
     - `availableTime` - å¯ç”¨æ—¶é—´

3. **è°ƒç”¨LLMï¼ˆOpenRouter APIï¼‰**
   ```typescript
   const result = await invokeLLM({
     messages: [
       { role: "system", content: "..." },
       { role: "user", content: prompt },
     ],
     response_format: {
       type: "json_schema",
       json_schema: {
         name: "resume_parse_result",
         strict: false,
         schema: { /* JSON Schemaå®šä¹‰ */ },
       },
     },
   });
   ```

4. **è§£æAIè¿”å›ç»“æœ**
   - æ”¯æŒä¸¤ç§æ ¼å¼ï¼š
     - JSONå­—ç¬¦ä¸²ï¼šä½¿ç”¨ `JSON.parse()` è§£æ
     - å¯¹è±¡ï¼šç›´æ¥ä½¿ç”¨
   - æ¸…ç†ç©ºå€¼å’Œ `"null"` å­—ç¬¦ä¸²

5. **è¿”å›ç»“æ„åŒ–æ•°æ®**
   ```typescript
   {
     studentId?: string;
     grade?: string;
     major?: string;
     gpa?: string;
     skills?: string;
     researchInterests?: string;
     projectExperience?: string;
     availableTime?: string;
   }
   ```

**å®¹é”™æœºåˆ¶**ï¼š
- å¦‚æœAIè§£æå¤±è´¥ï¼Œè¿”å›ç©ºå¯¹è±¡ `{}`ï¼Œä¸æŠ›å‡ºé”™è¯¯
- ç”¨æˆ·ä»å¯ä»¥æ‰‹åŠ¨å¡«å†™è¡¨å•

---

### ç¬¬äº”æ­¥ï¼šæ–‡ä»¶å­˜å‚¨

**ä½ç½®**ï¼š`server/services/storage/local.ts`

**æµç¨‹**ï¼š

1. **ç”Ÿæˆæ–‡ä»¶è·¯å¾„**
   ```typescript
   const fileKey = `resumes/user-${ctx.user.id}/${Date.now()}-${input.fileName}`;
   // ç¤ºä¾‹: "resumes/user-123/1703123456789-resume.pdf"
   ```

2. **è½¬æ¢Base64ä¸ºBuffer**
   ```typescript
   const pdfBuffer = Buffer.from(
     input.file.includes(",") ? input.file.split(",")[1] : input.file,
     "base64"
   );
   ```

3. **ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ**
   ```typescript
   // å­˜å‚¨ç›®å½•: process.cwd() + "/uploads"
   // å®Œæ•´è·¯å¾„: uploads/resumes/user-123/1703123456789-resume.pdf
   await storage.storagePut(fileKey, pdfBuffer, "application/pdf");
   ```

4. **ç”Ÿæˆå…¬å¼€URL**
   ```typescript
   // URLæ ¼å¼: "/uploads/resumes/user-123/1703123456789-resume.pdf"
   const url = `${PUBLIC_URL_PREFIX}/${normalizedKey}`;
   ```

5. **åˆ é™¤æ—§ç®€å†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰**
   ```typescript
   if (existingProfile?.resumeKey) {
     await storage.storageDelete(existingProfile.resumeKey);
   }
   ```

---

### ç¬¬å…­æ­¥ï¼šæ•°æ®åº“æ›´æ–°

**ä½ç½®**ï¼š`server/repositories/student-profile.repository.ts`

**æµç¨‹**ï¼š

1. **æ£€æŸ¥æ˜¯å¦å·²æœ‰æ¡£æ¡ˆ**
   ```typescript
   const existingProfile = await db.getStudentProfileByUserId(ctx.user.id);
   ```

2. **å‡†å¤‡æ›´æ–°æ•°æ®**
   ```typescript
   const profileUpdates = {
     resumeUrl: url,        // æ–‡ä»¶URL
     resumeKey: key,        // æ–‡ä»¶å­˜å‚¨é”®
     // AIè§£æçš„å­—æ®µï¼ˆä»…åŒ…å«æœ‰å€¼çš„å­—æ®µï¼‰
     ...(parsedData.studentId && { studentId: parsedData.studentId }),
     ...(parsedData.grade && { grade: parsedData.grade }),
     // ... å…¶ä»–å­—æ®µ
   };
   ```

3. **æ›´æ–°æˆ–åˆ›å»ºæ¡£æ¡ˆ**
   ```typescript
   if (existingProfile) {
     // æ›´æ–°ç°æœ‰æ¡£æ¡ˆ
     await db.updateStudentProfile(ctx.user.id, profileUpdates);
   } else {
     // åˆ›å»ºæ–°æ¡£æ¡ˆ
     await db.createStudentProfile({
       userId: ctx.user.id,
       ...profileUpdates,
     });
   }
   ```

**æ•°æ®åº“æ“ä½œ**ï¼š
- ä½¿ç”¨ Drizzle ORM è¿›è¡Œç±»å‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œ
- æ›´æ–° `student_profiles` è¡¨

---

### ç¬¬ä¸ƒæ­¥ï¼šè¿”å›ç»“æœç»™å‰ç«¯

**ä½ç½®**ï¼š`server/routes/student.ts`

**è¿”å›æ•°æ®**ï¼š
```typescript
{
  success: true,
  resumeUrl: "/uploads/resumes/user-123/...",
  resumeKey: "resumes/user-123/...",
  parsedData: {
    studentId: "...",
    grade: "...",
    // ... å…¶ä»–è§£æå­—æ®µ
  },
}
```

---

### ç¬¬å…«æ­¥ï¼šå‰ç«¯è‡ªåŠ¨å¡«å……è¡¨å•

**ä½ç½®**ï¼š`client/src/pages/student/Profile.tsx`

**æµç¨‹**ï¼š

1. **æ¥æ”¶è§£æç»“æœ**
   ```typescript
   const result = await uploadResumeMutation.mutateAsync({ ... });
   ```

2. **è‡ªåŠ¨å¡«å……è¡¨å•å­—æ®µ**
   ```typescript
   if (result.parsedData) {
     setFormData((prev) => ({
       ...prev,
       ...(result.parsedData.studentId && { studentId: result.parsedData.studentId }),
       ...(result.parsedData.grade && { grade: result.parsedData.grade }),
       // ... å…¶ä»–å­—æ®µ
     }));
   }
   ```

3. **æ˜¾ç¤ºæˆåŠŸæç¤º**
   ```typescript
   toast.success("ç®€å†ä¸Šä¼ æˆåŠŸï¼Œå·²è‡ªåŠ¨å¡«å……ä¿¡æ¯");
   ```

4. **åˆ·æ–°æ¡£æ¡ˆæ•°æ®**
   ```typescript
   utils.studentProfile.get.invalidate();
   ```

5. **é‡ç½®æ–‡ä»¶è¾“å…¥**
   ```typescript
   if (fileInputRef.current) {
     fileInputRef.current.value = "";
   }
   ```

---

## ğŸ”„ å®Œæ•´æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‰ç«¯ (Profile.tsx)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ç”¨æˆ·é€‰æ‹©PDFæ–‡ä»¶                                           â”‚
â”‚ 2. éªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°                                        â”‚
â”‚ 3. FileReader è½¬æ¢ä¸º Base64                                  â”‚
â”‚ 4. è°ƒç”¨ trpc.studentProfile.uploadResume.mutateAsync()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP POST /api/trpc/...
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åç«¯è·¯ç”± (server/routes/student.ts)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. tRPC ä¸­é—´ä»¶éªŒè¯ç”¨æˆ·èº«ä»½                                   â”‚
â”‚ 2. Zod éªŒè¯è¾“å…¥å‚æ•°                                          â”‚
â”‚ 3. è°ƒç”¨ parsePDFFromBase64()                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          PDFè§£ææœåŠ¡ (server/services/resume-parser.ts)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Base64 â†’ Buffer â†’ Uint8Array                             â”‚
â”‚ 2. pdfjs-dist åŠ è½½PDFæ–‡æ¡£                                    â”‚
â”‚ 3. é€é¡µæå–æ–‡æœ¬å†…å®¹                                          â”‚
â”‚ 4. è¿”å› { text, pages, info }                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      AIè§£ææœåŠ¡ (server/services/ai/resume-ai-parser.ts)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ–‡æœ¬é¢„å¤„ç†ï¼ˆæ¸…ç†ã€æˆªæ–­ï¼‰                                   â”‚
â”‚ 2. æ„å»ºAIæç¤ºè¯                                              â”‚
â”‚ 3. è°ƒç”¨ invokeLLM() (OpenRouter API)                         â”‚
â”‚ 4. è§£æJSONå“åº”                                              â”‚
â”‚ 5. è¿”å›ç»“æ„åŒ–æ•°æ®                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ–‡ä»¶å­˜å‚¨ (server/services/storage/local.ts)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ç”Ÿæˆæ–‡ä»¶è·¯å¾„ (resumes/user-{id}/...)                      â”‚
â”‚ 2. Base64 â†’ Buffer                                           â”‚
â”‚ 3. å†™å…¥æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ (uploads/)                               â”‚
â”‚ 4. ç”Ÿæˆå…¬å¼€URL (/uploads/...)                               â”‚
â”‚ 5. åˆ é™¤æ—§ç®€å†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ•°æ®åº“æ“ä½œ (server/repositories/student-profile.ts)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æŸ¥è¯¢ç°æœ‰æ¡£æ¡ˆ                                              â”‚
â”‚ 2. å‡†å¤‡æ›´æ–°æ•°æ®ï¼ˆç®€å†URL + AIè§£æå­—æ®µï¼‰                      â”‚
â”‚ 3. æ›´æ–°æˆ–åˆ›å»ºæ¡£æ¡ˆ                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¿”å›ç»“æœç»™å‰ç«¯                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ { success, resumeUrl, resumeKey, parsedData }               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‰ç«¯è‡ªåŠ¨å¡«å……è¡¨å•                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ¥æ”¶è§£æç»“æœ                                              â”‚
â”‚ 2. æ›´æ–° formData çŠ¶æ€                                        â”‚
â”‚ 3. æ˜¾ç¤ºæˆåŠŸæç¤º                                              â”‚
â”‚ 4. åˆ·æ–°æ¡£æ¡ˆæ•°æ®                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ é”™è¯¯å¤„ç†

### å‰ç«¯é”™è¯¯å¤„ç†

1. **æ–‡ä»¶ç±»å‹é”™è¯¯**
   - æç¤ºï¼š`"ä»…æ”¯æŒPDFæ ¼å¼æ–‡ä»¶"`
   - é˜»æ­¢ä¸Šä¼ 

2. **æ–‡ä»¶å¤§å°è¶…é™**
   - æç¤ºï¼š`"æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB"`
   - é˜»æ­¢ä¸Šä¼ 

3. **ä¸Šä¼ å¤±è´¥**
   - æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼ˆä»åç«¯è¿”å›ï¼‰
   - é‡ç½®ä¸Šä¼ çŠ¶æ€ä¸º `"idle"`

### åç«¯é”™è¯¯å¤„ç†

1. **PDFè§£æå¤±è´¥**
   - é”™è¯¯ï¼š`"PDFè§£æå¤±è´¥ï¼šæœªèƒ½æå–æ–‡æœ¬å†…å®¹"`
   - å¯èƒ½åŸå› ï¼šPDFæ˜¯çº¯å›¾ç‰‡æ‰«æä»¶

2. **AIè§£æå¤±è´¥**
   - è¿”å›ç©ºå¯¹è±¡ `{}`
   - ä¸æŠ›å‡ºé”™è¯¯ï¼Œå…è®¸ç”¨æˆ·æ‰‹åŠ¨å¡«å†™

3. **æ–‡ä»¶å­˜å‚¨å¤±è´¥**
   - æŠ›å‡ºé”™è¯¯ï¼Œå›æ»šæ“ä½œ

4. **æ•°æ®åº“æ›´æ–°å¤±è´¥**
   - æŠ›å‡ºé”™è¯¯ï¼Œå‰ç«¯æ˜¾ç¤ºé”™è¯¯æç¤º

---

## ğŸ“ å…³é”®æ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | èŒè´£ |
|---------|------|
| `client/src/pages/student/Profile.tsx` | å‰ç«¯UIå’Œæ–‡ä»¶ä¸Šä¼ é€»è¾‘ |
| `server/routes/student.ts` | tRPCè·¯ç”±ï¼Œåè°ƒæ•´ä¸ªæµç¨‹ |
| `server/services/resume-parser.ts` | PDFæ–‡æœ¬æå– |
| `server/services/ai/resume-ai-parser.ts` | AIç»“æ„åŒ–ä¿¡æ¯æå– |
| `server/services/storage/local.ts` | æœ¬åœ°æ–‡ä»¶å­˜å‚¨ |
| `server/repositories/student-profile.repository.ts` | æ•°æ®åº“æ“ä½œ |
| `server/core/services/ai/llm.ts` | LLMè°ƒç”¨æœåŠ¡ |

---

## ğŸ¯ è®¾è®¡äº®ç‚¹

1. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ TypeScript + tRPC + Zodï¼Œç«¯åˆ°ç«¯ç±»å‹æ£€æŸ¥
2. **å®¹é”™æœºåˆ¶**ï¼šAIè§£æå¤±è´¥ä¸å½±å“æ–‡ä»¶ä¸Šä¼ ï¼Œç”¨æˆ·å¯æ‰‹åŠ¨å¡«å†™
3. **æ–‡ä»¶ç®¡ç†**ï¼šè‡ªåŠ¨åˆ é™¤æ—§ç®€å†ï¼Œé¿å…å­˜å‚¨ç©ºé—´æµªè´¹
4. **ç”¨æˆ·ä½“éªŒ**ï¼šè‡ªåŠ¨å¡«å……è¡¨å•ï¼Œå‡å°‘æ‰‹åŠ¨è¾“å…¥
5. **å®‰å…¨æ€§**ï¼šæ–‡ä»¶ç±»å‹å’Œå¤§å°éªŒè¯ï¼Œé˜²æ­¢æ¶æ„æ–‡ä»¶ä¸Šä¼ 

---

## ğŸ”§ é…ç½®è¦æ±‚

### ç¯å¢ƒå˜é‡

- `OPENROUTER_API_KEY` - OpenRouter APIå¯†é’¥ï¼ˆç”¨äºAIè§£æï¼‰

### ç›®å½•ç»“æ„

- `uploads/` - æ–‡ä»¶å­˜å‚¨ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
- `uploads/resumes/user-{id}/` - æ¯ä¸ªç”¨æˆ·çš„ç®€å†å­˜å‚¨ç›®å½•

### Expressé™æ€æ–‡ä»¶æœåŠ¡

- è·¯å¾„ï¼š`/uploads`
- é…ç½®ä½ç½®ï¼š`server/core/framework/express.ts`
- å…è®¸é€šè¿‡URLç›´æ¥è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶


